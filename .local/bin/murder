#!/usr/bin/env perl

use strict;
use warnings;
use feature 'say';
use Time::HiRes qw(sleep);

our @SIGNALS = (
    [15, 3],
    [2, 3],
    [1, 4],
    [9, 0]
);

sub is_running {
    my ($pid) = @_;
    return `ps -p $pid` =~ tr/\n// == 2;
}

sub murder_pid {
    my ($pid) = @_;
    foreach my $sig (@SIGNALS) {
        my ($code, $wait) = @$sig;
        kill $code, $pid;
        sleep 0.5;
        return unless is_running $pid;
        sleep $wait;
    }
}

sub murder_names {
    my ($name) = @_;
    running = `ps -eo 'pid command' | grep -Fiw '$name' | grep -Fv grep`;
    foreach my $line (split(/\n/, $running)) {
        my ($pid, $fullname) = split(/\s+/, $line);
    }
}

def murder_names(name)
  loop do
    should_loop = false

    running = `ps -eo 'pid command' | grep -Fiw '#{name}' | grep -Fv grep`
    running.lines.each do |line|
      pid, fullname = line.split(nil, 2)

      next if Process.pid == pid.to_i

      print "murder #{fullname.chomp} (pid #{pid})? "
      if go_ahead?
        murder_pid(pid)
        should_loop = true
        break
      end
    end

    break unless should_loop
  end
end


sleep 0.5
