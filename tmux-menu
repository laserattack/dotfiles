#!/usr/bin/env bash

{
    tmux list-sessions -F '#S' | grep -v '^_popup_' | while read -r session; do
        echo "SESSION:$session"
        tmux list-windows -t "$session" -F 'WINDOW:#S:#I #W'
    done
} | sed 's/^SESSION:/S /' | sed 's/^WINDOW:/  W /' |
    fzf --reverse |
    awk '{
        if ($1 == "S") {
            print $2
        } else if ($1 == "W") {
            print $2
        }
    }' |
    xargs tmux switch-client -t
