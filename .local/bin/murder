#!/usr/bin/env perl

use strict;
use warnings;
use feature 'say';
use Time::HiRes qw(sleep);

our @SIGNALS = (
    [15, 3],
    [2, 3],
    [1, 4],
    [9, 0]
);

sub go_ahead {
    my $input = <STDIN>;
    chomp $input;
    $input =~ s/^\s+|\s+$//g;
    $input = lc($input);
    
    return $input =~ /^(y|yes|yas)$/ ? 1 : 0;
}

sub is_running {
    my ($pid) = @_;
    return `ps -p $pid` =~ tr/\n// == 2;
}

sub murder_pid {
    my ($pid) = @_;
    foreach my $sig (@SIGNALS) {
        my ($code, $wait) = @$sig;
        kill $code, $pid;
        sleep 0.5;
        return unless is_running $pid;
        sleep $wait;
    }
}

sub murder_names {
    my ($name) = @_;
    my $running = `ps -eo 'pid command' | grep -Fiw '$name' | grep -Fv grep`;
    foreach my $line (split(/\n/, $running)) {
        my ($pid, $fullname) = split(/\s+/, $line);
        next if $$ == $pid;
        print "murder $fullname (pid $pid)? ";
        if (go_ahead) {
            murder_pid($pid);
        }
    }
}
